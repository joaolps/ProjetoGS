-- Criação da tabela de Tipos de Fontes
CREATE TABLE TIPO_FONTES (
    ID_TIPO_FONTE NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(50)
);
 
-- Criação da tabela de Regiões Sustentáveis
CREATE TABLE REGIOES_SUSTENTAVEIS (
    ID_REGIAO NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(50)
);
 
-- Criação da tabela de Projetos Sustentáveis
CREATE TABLE PROJETOS_SUSTENTAVEIS (
    ID_PROJETO NUMBER(6) PRIMARY KEY,
    DESCRICAO VARCHAR2(255),
    CUSTO NUMBER(10,2),
    STATUS VARCHAR2(20),
    ID_TIPO_FONTE NUMBER(6),
    ID_REGIAO NUMBER(6),
    CONSTRAINT PROJETOS_SUSTENTAVEIS_FK1 FOREIGN KEY (ID_TIPO_FONTE) REFERENCES TIPO_FONTES(ID_TIPO_FONTE),
    CONSTRAINT PROJETOS_SUSTENTAVEIS_FK2 FOREIGN KEY (ID_REGIAO) REFERENCES REGIOES_SUSTENTAVEIS(ID_REGIAO)
);
 
-- Criação da tabela de Emissões de Carbono
CREATE TABLE EMISSOES_CARBONO (
    ID_EMISSAO NUMBER(6) PRIMARY KEY,
    ID_TIPO_FONTE NUMBER(6),
    EMISSAO NUMBER(10,2),
    CONSTRAINT EMISSOES_CARBONO_FK FOREIGN KEY (ID_TIPO_FONTE) REFERENCES TIPO_FONTES(ID_TIPO_FONTE)
);

-- Inserindo tipos de fontes na tabela TIPO_FONTES
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (1, 'Solar');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (2, 'Eólica');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (3, 'Hidrelétrica');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (4, 'Biomassa');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (5, 'Geotérmica');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (6, 'Nuclear');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (7, 'Maré');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (8, 'Ondas');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (9, 'Hidrogênio');
INSERT INTO TIPO_FONTES (ID_TIPO_FONTE, NOME) VALUES (10, 'Biogás');

-- Inserindo regiões na tabela REGIOES_SUSTENTAVEIS
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (1, 'Nordeste');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (2, 'Sudeste');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (3, 'Sul');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (4, 'Centro-Oeste');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (5, 'Norte');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (6, 'Litoral');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (7, 'Interior');
INSERT INTO REGIOES_SUSTENTAVEIS (ID_REGIAO, NOME) VALUES (8, 'Amazônia');


-- Inserindo projetos na tabela PROJETOS_SUSTENTAVEIS
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (1, 'Projeto Solar Fortaleza', 1200000.00, 'Em andamento', 1, 1);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (2, 'Parque Eólico Bahia', 3000000.00, 'Concluído', 2, 1);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (3, 'Usina Hidrelétrica Belo Monte', 15000000.00, 'Em andamento', 3, 5);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (4, 'Usina de Biomassa São Paulo', 2000000.00, 'Concluído', 4, 2);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (5, 'Projeto Geotérmico Curitiba', 500000.00, 'Planejado', 5, 3);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (6, 'Projeto de Maré Recife', 8000000.00, 'Planejado', 7, 6);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (7, 'Parque de Ondas Rio', 4000000.00, 'Em andamento', 8, 6);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (8, 'Usina de Hidrogênio Amazonas', 2500000.00, 'Concluído', 9, 8);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (9, 'Usina de Biogás Brasília', 2000000.00, 'Planejado', 10, 4);
INSERT INTO PROJETOS_SUSTENTAVEIS (ID_PROJETO, DESCRICAO, CUSTO, STATUS, ID_TIPO_FONTE, ID_REGIAO) 
VALUES (10, 'Projeto Solar no Interior', 300000.00, 'Em andamento', 1, 7);

-- Inserindo dados de emissões na tabela EMISSOES_CARBONO
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (1, 1, 6000.00); -- Solar
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (2, 2, 7000.00); -- Eólica
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (3, 3, 8000.00); -- Hidrelétrica
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (4, 4, 9000.00); -- Biomassa
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (5, 5, 10000.00); -- Geotérmica
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (6, 1, 6200.00);  -- Solar
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (7, 2, 7200.00);  -- Eólica
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (8, 3, 8400.00);  -- Hidrelétrica
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (9, 7, 5500.00);  -- Maré
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (10, 8, 6300.00); -- Ondas
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (11, 9, 11000.00); -- Hidrogênio
INSERT INTO EMISSOES_CARBONO (ID_EMISSAO, ID_TIPO_FONTE, EMISSAO) VALUES (12, 10, 9000.00); -- Biogás


-- Consulta 1: Exibir o nome do tipo de fonte e a quantidade de projetos por tipo de fonte
-- Exibe apenas os tipos de fonte com mais de 2 projetos, ordenados em ordem alfabética
SELECT 
    tf.NOME AS Tipo_Fonte,
    COUNT(ps.ID_PROJETO) AS Quantidade_Projetos
FROM 
    TIPO_FONTES tf
JOIN 
    PROJETOS_SUSTENTAVEIS ps ON tf.ID_TIPO_FONTE = ps.ID_TIPO_FONTE
GROUP BY 
    tf.NOME
HAVING 
    COUNT(ps.ID_PROJETO) > 2
ORDER BY 
    tf.NOME;


-- Consulta 2: Exibir projetos que utilizam fontes de energia solar ou eólica
-- Lista o ID_PROJETO, DESCRICAO e CUSTO dos projetos, ordenado pela descrição
SELECT 
    ps.ID_PROJETO,
    ps.DESCRICAO,
    ps.CUSTO
FROM 
    PROJETOS_SUSTENTAVEIS ps
JOIN 
    TIPO_FONTES tf ON ps.ID_TIPO_FONTE = tf.ID_TIPO_FONTE
WHERE 
    tf.NOME IN ('Solar', 'Eólica')
ORDER BY 
    ps.DESCRICAO;


-- Consulta 3: Exibir projetos com custo superior a R$500.000,00 e status "Em andamento"
-- Mostra o ID_PROJETO, DESCRICAO e STATUS dos projetos, ordenados pelo ID_PROJETO
SELECT 
    ps.ID_PROJETO,
    ps.DESCRICAO,
    ps.STATUS
FROM 
    PROJETOS_SUSTENTAVEIS ps
WHERE 
    ps.CUSTO > 500000.00
    AND ps.STATUS = 'Em andamento'
ORDER BY 
    ps.ID_PROJETO;


-- Consulta 4: Exibir a média do custo dos projetos por região
-- Mostra o NOME da região e a média do custo dos projetos, arredondado para duas casas decimais e em ordem decrescente
SELECT 
    rs.NOME AS Regiao,
    ROUND(AVG(ps.CUSTO), 2) AS Media_Custo
FROM 
    REGIOES_SUSTENTAVEIS rs
JOIN 
    PROJETOS_SUSTENTAVEIS ps ON rs.ID_REGIAO = ps.ID_REGIAO
GROUP BY 
    rs.NOME
ORDER BY 
    Media_Custo DESC;


-- Consulta 5: Exibir o nome da região, tipo de fonte, quantidade de projetos e média das emissões de carbono
-- Exibe regiões com média de emissões superior a 5000, ordenadas por Regiao e Tipo_Fonte
SELECT 
    rs.NOME AS Regiao,
    tf.NOME AS Tipo_Fonte,
    COUNT(ps.ID_PROJETO) AS Total_Projetos,
    ROUND(AVG(ec.EMISSAO), 2) AS Media_Emissao_Carbono
FROM 
    REGIOES_SUSTENTAVEIS rs
JOIN 
    PROJETOS_SUSTENTAVEIS ps ON rs.ID_REGIAO = ps.ID_REGIAO
JOIN 
    TIPO_FONTES tf ON ps.ID_TIPO_FONTE = tf.ID_TIPO_FONTE
JOIN 
    EMISSOES_CARBONO ec ON tf.ID_TIPO_FONTE = ec.ID_TIPO_FONTE
GROUP BY 
    rs.NOME, tf.NOME
HAVING 
    AVG(ec.EMISSAO) > 5000
ORDER BY 
    Regiao, Tipo_Fonte;

DROP TABLE EMISSOES_CARBONO;
DROP TABLE PROJETOS_SUSTENTAVEIS;
DROP TABLE REGIOES_SUSTENTAVEIS;
DROP TABLE TIPO_FONTES;
